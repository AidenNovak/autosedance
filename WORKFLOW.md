# AutoSedance - 交互式视频生成工作流

## 概述

由于视频生成API账户余额不足，系统已调整为**人工视频上传模式**。系统负责：
1. 生成完整剧本
2. 生成分片剧本和视频Prompt
3. **等待用户上传视频**
4. 分析视频内容，截取最后一帧
5. 循环处理下一个片段
6. 拼接所有视频

## 工作流程

```
┌─────────────────────────────────────────────────────────────┐
│                    AutoSedance 工作流                        │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  1. 编剧模型 → 完整剧本 (in0)                                │
│         ↓                                                   │
│  2. 分片模型 → 片段剧本 (in1) + 视频Prompt                   │
│         ↓                                                   │
│  3. [暂停] 用户根据Prompt生成/上传视频                       │
│         ↓                                                   │
│  4. 视频理解模型 → 视频描述 (in1B) + 最后一帧                 │
│         ↓                                                   │
│  5. 循环回到步骤2，生成下一片段                              │
│         ↓                                                   │
│  6. 所有片段完成后，自动拼接视频                             │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

## 使用方法

### 方式1: 交互式运行

```bash
python3 run_interactive.py
```

系统会：
1. 生成剧本并保存到 `output/full_script.txt`
2. 生成片段0的剧本，保存到 `output/segments/segment_000.txt`
3. 等待你上传视频到 `output/input_videos/segment_000.mp4`
4. 输入 `check` 检查视频是否上传
5. 系统分析视频，生成下一片段剧本
6. 重复直到完成

### 方式2: 批量上传

1. 运行脚本获取所有片段的Prompt
2. 根据Prompt批量生成视频
3. 将所有视频放到 `output/input_videos/` 目录
4. 重新运行脚本，系统会自动检测已上传的视频

## 目录结构

```
output/
├── full_script.txt          # 完整剧本
├── segments/                # 片段信息
│   ├── segment_000.txt
│   ├── segment_001.txt
│   └── ...
├── input_videos/            # 用户上传的视频（重要！）
│   ├── segment_000.mp4
│   ├── segment_001.mp4
│   └── ...
├── frames/                  # 截取的最后一帧
│   ├── frame_000.jpg
│   └── ...
└── final/
    └── output.mp4           # 最终拼接的视频
```

## 视频命名规则

上传的视频文件名支持：
- `segment_000.mp4`, `segment_001.mp4`, ...
- `seg_000.mp4`, `seg_001.mp4`, ...
- `000.mp4`, `001.mp4`, ...

## 帧连续性保证

系统通过以下方式确保视频片段之间的连续性：
1. 截取每个视频的最后一帧
2. 将最后一帧的描述传递给分片模型
3. 分片模型在生成下一片段时会考虑上一帧的内容
4. 视频Prompt中包含连续性要素描述

## 已配置的API

| 功能 | 模型 | 提供商 | 状态 |
|------|------|--------|------|
| 编剧/分片 | doubao-seed-2-0-pro-260215 | 火山引擎 | ✅ 可用 |
| 视频理解 | doubao-seed-2-0-pro (多模态) | 火山引擎 | ✅ 可用 |
| 视频生成 | - | 人工上传 | 👤 用户负责 |
