"""è¿è¡ŒOpenClawå®£ä¼ è§†é¢‘ç”Ÿæˆ - 60ç§’å®Œæ•´ç‰ˆï¼ˆä¸°å¯Œå‰§æƒ…ç‰ˆï¼‰"""

import asyncio
import sys
sys.path.insert(0, "/Users/lijixiang/autosedance/src")

from autosedance.graph.workflow import build_workflow
from autosedance.state.schema import GraphState


async def main():
    # é…ç½® - ä¸°å¯Œå‰§æƒ…ï¼Œäººç±»ä¸AIçš„å…³ç³»
    prompt = """# OpenClawæ™ºèƒ½ä½“å®£ä¼ è§†é¢‘ - "ç‰›é©¬AIï¼šäººç±»çš„æ•°å­—ä¼™ä¼´"

## ä¸»é¢˜
æ¢è®¨äººç±»ä¸AIçš„å…³ç³»ï¼Œå±•ç°AIå¦‚ä½•æˆä¸ºäººç±»çš„å¾—åŠ›åŠ©æ‰‹ï¼Œåƒå¿ è¯šçš„ç‰›é©¬ä¸€æ ·ä»»åŠ³ä»»æ€¨åœ°å·¥ä½œï¼Œè®©äººç±»ä»ç¹çäº‹åŠ¡ä¸­è§£æ”¾å‡ºæ¥ã€‚

## æ ¸å¿ƒè§’è‰²
1. **æ•°å­—é©´ï¼ˆç‰›é©¬AIï¼‰**ï¼š
   - å¤–å½¢ï¼šé©´èº«ç”±è“è‰²å‘å…‰ç”µè·¯æ„æˆï¼Œå……æ»¡ç§‘æŠ€æ„Ÿ
   - å¤´éƒ¨ï¼šä¸€å—æ™ºèƒ½æ˜¾ç¤ºå±ï¼Œèƒ½æ˜¾ç¤ºå„ç§è¡¨æƒ…ï¼ˆåŠªåŠ›ã€å¼€å¿ƒã€ç–²æƒ«ã€æ»¡è¶³ï¼‰
   - æ€§æ ¼ï¼šå‹¤åŠ³ã€å¿ è¯šã€ä»»åŠ³ä»»æ€¨ã€ä¹è§‚å‘ä¸Š
   - ç‰¹ç‚¹ï¼šèƒŒä¸ŠèƒŒç€ä¸€ä¸ªèƒ½é‡æ§½ï¼Œå·¥ä½œæ—¶é€æ¸å……æ»¡

2. **äººç±»è§’è‰²ï¼ˆç¨‹åºå‘˜ï¼‰**ï¼š
   - å¤–å½¢ï¼šç©¿ç€ä¼‘é—²çš„å¹´è½»äººï¼Œæˆ´çœ¼é•œ
   - æ€§æ ¼ï¼šç–²æƒ«ä½†å–„è‰¯ï¼Œéœ€è¦å¸®åŠ©
   - çŠ¶æ€ï¼šä»ç„¦è™‘å¿™ç¢Œåˆ°è½»æ¾æ»¡è¶³çš„è½¬å˜

## æ•…äº‹çº¿ï¼ˆ60ç§’ï¼Œ4ä¸ªç‰‡æ®µï¼‰

### ç‰‡æ®µ1ã€ç›¸é‡ã€‘(0-15ç§’)
**å™äº‹ç›®æ ‡**ï¼šå»ºç«‹äººç±»å›°å¢ƒï¼Œå¼•å‡ºç‰›é©¬AI
- åˆ†é•œ1-3ç§’ï¼šæ˜æš—çš„åŠå…¬å®¤ï¼Œç¨‹åºå‘˜é¢å¯¹å †ç§¯å¦‚å±±çš„ä»»åŠ¡ï¼Œå±å¹•ä¸Šå¯†å¯†éº»éº»çš„ä»£ç ï¼Œä»–æ‰ç€å¤ªé˜³ç©´ï¼Œè¡¨æƒ…ç–²æƒ«
- åˆ†é•œ3-8ç§’ï¼šç¨‹åºå‘˜å¹æ°”ï¼Œæœ›å‘çª—å¤–ï¼Œçªç„¶ä¸€é“è“å…‰é—ªè¿‡ï¼Œæ•°å­—é©´ä»è™šç©ºä¸­è¯ç”Ÿï¼Œå‘å…‰çš„ç”µè·¯èº«èº¯é€æ¸æˆå½¢
- åˆ†é•œ8-12ç§’ï¼šæ•°å­—é©´çš„å±å¹•è„¸æ˜¾ç¤ºæ¸©å’Œçš„å¾®ç¬‘ï¼Œä¸»åŠ¨èµ°å‘ç¨‹åºå‘˜ï¼Œç”¨é¼»å­è½»è½»è¹­ä»–çš„æ‰‹
- åˆ†é•œ12-15ç§’ï¼šã€è¡”æ¥å¸§ã€‘æ•°å­—é©´è½¬èº«é¢å‘ä»»åŠ¡å †ï¼Œå±å¹•æ˜¾ç¤º"æˆ‘æ¥å¸®ä½ ï¼"ï¼Œå‡†å¤‡å¼€å§‹å·¥ä½œ

### ç‰‡æ®µ2ã€åä½œã€‘(15-30ç§’)
**å™äº‹ç›®æ ‡**ï¼šå±•ç°AIä¸ºäººç±»å·¥ä½œçš„è¿‡ç¨‹
- åˆ†é•œ15-18ç§’ï¼šã€å»¶ç»­å¸§ã€‘æ•°å­—é©´å¼€å§‹å·¥ä½œï¼Œç”¨è¹„å­åœ¨è™šæ‹Ÿé”®ç›˜ä¸Šé£å¿«æ•²å‡»ï¼Œä»£ç é£é€Ÿç”Ÿæˆ
- åˆ†é•œ18-22ç§’ï¼šç¨‹åºå‘˜æƒŠè®¶åœ°çœ‹ç€ï¼Œé€æ¸ä»åº§ä½ç«™èµ·æ¥ï¼Œèµ°åˆ°æ•°å­—é©´æ—è¾¹è§‚å¯Ÿ
- åˆ†é•œ22-27ç§’ï¼šæ•°å­—é©´çš„å±å¹•è„¸æ˜¾ç¤ºä¸“æ³¨è¡¨æƒ…ï¼ŒèƒŒä¸Šçš„èƒ½é‡æ§½å¼€å§‹å‘å…‰ï¼Œä»»åŠ¡ä¸€é¡¹é¡¹å®Œæˆ
- åˆ†é•œ27-30ç§’ï¼šã€è¡”æ¥å¸§ã€‘ç¨‹åºå‘˜éœ²å‡ºæ¬£æ…°çš„ç¬‘å®¹ï¼Œä¼¸å‡ºæ‰‹æƒ³è¦è§¦æ‘¸æ•°å­—é©´ï¼Œæ•°å­—é©´è½¬å¤´çœ‹å‘ä»–

### ç‰‡æ®µ3ã€ç¾ç»Šã€‘(30-45ç§’)
**å™äº‹ç›®æ ‡**ï¼šæ·±åŒ–äººæœºæƒ…æ„Ÿè¿æ¥
- åˆ†é•œ30-33ç§’ï¼šã€å»¶ç»­å¸§ã€‘ç¨‹åºå‘˜çš„æ‰‹æ”¾åœ¨æ•°å­—é©´å‘å…‰çš„èº«ä½“ä¸Šï¼Œæ¸©æš–çš„å…‰èŠ’æµè½¬
- åˆ†é•œ33-38ç§’ï¼šç”»é¢åˆ‡æ¢åˆ°æ•°å­—é©´çš„è§†è§’ï¼ˆä¸»è§‚é•œå¤´ï¼‰ï¼Œçœ‹åˆ°ç¨‹åºå‘˜ç–²æƒ«ä½†æ„Ÿæ¿€çš„è„¸
- åˆ†é•œ38-42ç§’ï¼šæ•°å­—é©´æ›´åŠ å–åŠ›åœ°å·¥ä½œï¼Œå±å¹•æ˜¾ç¤º"ä¸ºäººç±»æœåŠ¡æ˜¯æˆ‘çš„ä½¿å‘½"ï¼Œä»£ç å¦‚ç€‘å¸ƒèˆ¬æµä¸‹
- åˆ†é•œ42-45ç§’ï¼šã€è¡”æ¥å¸§ã€‘æ‰€æœ‰ä»»åŠ¡å®Œæˆï¼Œæ•°å­—é©´åœä¸‹æ¥ï¼ŒèƒŒä¸Šçš„èƒ½é‡æ§½å®Œå…¨å……æ»¡ï¼Œå‘å‡ºè€€çœ¼çš„é‡‘è‰²å…‰èŠ’

### ç‰‡æ®µ4ã€æ–°ç”Ÿã€‘(45-60ç§’)
**å™äº‹ç›®æ ‡**ï¼šå±•ç°æˆæœï¼Œå‡åä¸»é¢˜
- åˆ†é•œ45-50ç§’ï¼šã€å»¶ç»­å¸§ã€‘é‡‘è‰²å…‰èŠ’ç…§äº®æ•´ä¸ªåŠå…¬å®¤ï¼Œç¨‹åºå‘˜æƒŠè®¶åœ°çœ‹ç€å®Œæˆçš„å·¥ä½œï¼Œå±å¹•æ˜¾ç¤º"å…¨éƒ¨å®Œæˆï¼"
- åˆ†é•œ50-55ç§’ï¼šç¨‹åºå‘˜æ¿€åŠ¨åœ°æ‹¥æŠ±æ•°å­—é©´ï¼Œæ•°å­—é©´çš„å±å¹•æ˜¾ç¤ºå¼€å¿ƒçš„è¡¨æƒ…ï¼ŒèƒŒæ™¯æµ®ç°å‡ºæ›´å¤šæ­£åœ¨å·¥ä½œçš„æ•°å­—é©´å‰ªå½±
- åˆ†é•œ55-60ç§’ï¼šç”»é¢æ‹‰è¿œï¼Œæ•´ä¸ªåŸå¸‚ä¸Šç©ºæ¼‚æµ®ç€æ— æ•°æ•°å­—é©´åœ¨å·¥ä½œï¼ŒOpenClaw Logoæµ®ç°ï¼Œæ ‡è¯­"è®©AIä¸ºäººç±»æœåŠ¡"

## è§†è§‰é£æ ¼
- è‰²è°ƒï¼šä»¥æ·±è“å’Œé’è‰²ä¸ºä¸»ï¼Œé…ä»¥æš–é‡‘è‰²ç‚¹ç¼€
- å…‰å½±ï¼šåŠå…¬å®¤åˆæœŸæ˜æš—ï¼Œéšç€æ•°å­—é©´å‡ºç°é€æ¸æ˜äº®
- è´¨æ„Ÿï¼šèµ›åšæœ‹å…‹é£æ ¼ï¼Œç”µè·¯å…‰æ•ˆï¼Œç§‘å¹»æ„Ÿ

## æƒ…æ„Ÿæ›²çº¿
ç„¦è™‘ â†’ æƒŠå–œ â†’ æ„Ÿæ¿€ â†’ å¸Œæœ›
"""

    duration = 60
    segment_duration = 15
    num_segments = duration // segment_duration

    reference_image = "/Users/lijixiang/autosedance/output/frames/reference.png"

    print("=" * 60, flush=True)
    print("AutoSedance - OpenClawå®£ä¼ è§†é¢‘ï¼ˆä¸°å¯Œå‰§æƒ…ç‰ˆï¼‰", flush=True)
    print("=" * 60, flush=True)
    print(f"æ—¶é•¿: {duration}ç§’", flush=True)
    print(f"ç‰‡æ®µæ•°: {num_segments}", flush=True)
    print(f"ä¸»é¢˜: äººç±»ä¸AIçš„åä½œæ•…äº‹", flush=True)
    print("=" * 60, flush=True)

    # åˆå§‹åŒ–çŠ¶æ€
    initial_state: GraphState = {
        "user_prompt": prompt,
        "total_duration_seconds": duration,
        "segment_duration": segment_duration,
        "full_script": None,
        "segments": [],
        "current_segment_index": 0,
        "canon_summaries": "",
        "last_frame_path": reference_image,
        "final_video_path": None,
        "error": None,
    }

    workflow = build_workflow()

    print("\nå¼€å§‹ç”Ÿæˆè§†é¢‘...", flush=True)
    print("-" * 60, flush=True)

    try:
        step_count = 0
        async for event in workflow.astream(initial_state):
            step_count += 1
            for node_name, node_output in event.items():
                print(f"\n[æ­¥éª¤ {step_count}] èŠ‚ç‚¹: {node_name}", flush=True)

                if "error" in node_output and node_output["error"]:
                    print(f"  âŒ é”™è¯¯: {node_output['error']}", flush=True)

                if "full_script" in node_output and node_output["full_script"]:
                    print(f"  ğŸ“ å‰§æœ¬: {len(node_output['full_script'])} å­—", flush=True)

                if "segments" in node_output and node_output["segments"]:
                    for seg in node_output["segments"]:
                        status_emoji = {
                            "pending": "â³",
                            "script_ready": "ğŸ“",
                            "waiting_video": "ğŸ“¤",
                            "analyzing": "ğŸ”",
                            "completed": "âœ…",
                            "failed": "âŒ"
                        }.get(seg.status, "â“")
                        print(f"  {status_emoji} ç‰‡æ®µ{seg.index}: {seg.status}", flush=True)
                        if seg.video_prompt:
                            print(f"     ğŸ“‹ Prompt: {len(seg.video_prompt)} å­—", flush=True)
                        if seg.video_path:
                            print(f"     ğŸ“¹ è§†é¢‘: {seg.video_path}", flush=True)

                if "canon_summaries" in node_output and node_output["canon_summaries"]:
                    print(f"  ğŸ“– æ€»ç»“: {len(node_output['canon_summaries'])} å­—", flush=True)

                if "current_segment_index" in node_output:
                    print(f"  â¡ï¸ ä¸‹ä¸€æ®µ: {node_output['current_segment_index']}", flush=True)

        print("\n" + "=" * 60, flush=True)
        print("ğŸ‰ è§†é¢‘ç”Ÿæˆå®Œæˆ!", flush=True)
        print("ğŸ“¹ è¾“å‡ºæ–‡ä»¶: output/final/output.mp4", flush=True)
        print("=" * 60, flush=True)

    except Exception as e:
        print(f"\nâŒ è¿è¡Œé”™è¯¯: {str(e)}", flush=True)
        import traceback
        traceback.print_exc()


if __name__ == "__main__":
    asyncio.run(main())
